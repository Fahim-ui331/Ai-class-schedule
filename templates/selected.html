<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Selected Schedule</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="goschool">
  <header>
    <div class="container">
      <div class="nav-arrows">
        <button onclick="goBack()" aria-label="Go Back">⬅</button>
        <button onclick="history.forward()" aria-label="Go Forward">➡</button>
      </div>
      <h1 class="brand"><span class="cap"></span> Selected Schedule</h1>
      <nav>
        <a href="index.html">Back</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <section>
        <h2>Your Choice</h2>
        <div class="card" id="choiceCard">
          <p><strong>Student:</strong> <span id="cName"></span> (<span id="cStudentID"></span>)</p>
          <p><strong>GPA:</strong> <span id="cGPA"></span></p>
          <p><strong>Course:</strong> <span id="cCourse"></span></p>
          <p><strong>Section:</strong> <span id="cSection"></span></p>
          <p><strong>Payment Status:</strong> <span id="cPayment" class="badge badge-cleared">Cleared</span></p>
        </div>
      </section>

      <section class="assigned-schedule">
        <h2>Your Weekly Schedule</h2>
        <div id="timetable-container"></div>
      </section>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 AI-Based Class Schedule Generator | United International University</p>
  </footer>

  <script>
    // Back button function
    function goBack() {
      if (document.referrer) {
        history.back();
      } else {
        window.location.href = "index.html";
      }
    }

    // Sample data (replace with CSV loading in production)
    const assignedSections = [
      { Student_ID: "S006", Name: "Student_6", GPA: 3.95, Course: "Programming", Preferred_Sections: "C,B", Assigned_Section: "C", Department: "CSE", Semester: "Spring2025", Course_Load: 17 },
      { Student_ID: "S001", Name: "Student_1", GPA: 3.90, Course: "Math", Preferred_Sections: "A,B", Assigned_Section: "A", Department: "CSE", Semester: "Spring2025", Course_Load: 15 },
      { Student_ID: "S009", Name: "Student_9", GPA: 3.85, Course: "Physics", Preferred_Sections: "A", Assigned_Section: "A", Department: "CSE", Semester: "Summer2025", Course_Load: 18 },
      { Student_ID: "S003", Name: "Student_3", GPA: 3.75, Course: "Physics", Preferred_Sections: "A", Assigned_Section: "A", Department: "EEE", Semester: "Summer2025", Course_Load: 18 },
      { Student_ID: "S008", Name: "Student_8", GPA: 3.50, Course: "Math", Preferred_Sections: "A,B", Assigned_Section: "A", Department: "EEE", Semester: "Fall2025", Course_Load: 16 },
      { Student_ID: "S005", Name: "Student_5", GPA: 3.40, Course: "Math", Preferred_Sections: "B,A", Assigned_Section: "B", Department: "ENG", Semester: "Fall2025", Course_Load: 14 },
      { Student_ID: "S010", Name: "Student_10", GPA: 3.20, Course: "English", Preferred_Sections: "C,D", Assigned_Section: "D", Department: "ENG", Semester: "Spring2025", Course_Load: 12 },
      { Student_ID: "S002", Name: "Student_2", GPA: 2.85, Course: "English", Preferred_Sections: "C,D", Assigned_Section: "Not_Assigned", Department: "BBA", Semester: "Fall2025", Course_Load: 12 },
      { Student_ID: "S007", Name: "Student_7", GPA: 2.60, Course: "English", Preferred_Sections: "D,C", Assigned_Section: "Not_Assigned", Department: "BBA", Semester: "Summer2025", Course_Load: 13 },
      { Student_ID: "S004", Name: "Student_4", GPA: 2.80, Course: "Programming", Preferred_Sections: "B,C", Assigned_Section: "Not_Assigned", Department: "CSE", Semester: "Spring2025", Course_Load: 16 }
    ];

    const courses = [
      { course_id: "CS101", section: "A", day: "Monday", start_time: "09:00", end_time: "10:30", room: "Room 101", instructor: "Dr. Smith" },
      { course_id: "CS101", section: "B", day: "Wednesday", start_time: "14:00", end_time: "15:30", room: "Room 102", instructor: "Dr. Lee" },
      { course_id: "CS101", section: "C", day: "Monday", start_time: "09:00", end_time: "10:30", room: "Room 101", instructor: "Dr. Smith" },
      { course_id: "MATH201", section: "A", day: "Tuesday", start_time: "10:00", end_time: "11:30", room: "Room 201", instructor: "Prof. Kim" },
      { course_id: "MATH201", section: "B", day: "Tuesday", start_time: "14:00", end_time: "15:30", room: "Room 201", instructor: "Prof. Kim" },
      { course_id: "PHYS301", section: "A", day: "Thursday", start_time: "09:00", end_time: "10:30", room: "Room 301", instructor: "Dr. Patel" },
      { course_id: "ENGL101", section: "C", day: "Tuesday", start_time: "13:00", end_time: "14:30", room: "Room 401", instructor: "Dr. Brown" },
      { course_id: "ENGL101", section: "D", day: "Friday", start_time: "11:00", end_time: "12:30", room: "Room 402", instructor: "Dr. Green" }
    ];

    const courseMap = {
      "Programming": "CS101",
      "Math": "MATH201",
      "Physics": "PHYS301",
      "English": "ENGL101"
    };

    // Get student_id from URL
    const params = new URLSearchParams(window.location.search);
    const studentId = params.get('student_id') || 'S006'; // Default to S006 for testing

    // Find student data
    const student = assignedSections.find(s => s.Student_ID === studentId);
    const timetableContainer = document.getElementById('timetable-container');

    if (student) {
      const isEligible = student.GPA >= 3.50 && (student.Semester !== 'Fall2025' || true); // Assume payment cleared
      document.getElementById('cName').textContent = student.Name;
      document.getElementById('cStudentID').textContent = student.Student_ID;
      document.getElementById('cGPA').textContent = student.GPA;
      document.getElementById('cCourse').textContent = student.Course;
      document.getElementById('cSection').textContent = student.Assigned_Section;

      if (!isEligible) {
        document.getElementById('cPayment').className = 'badge badge-priority';
        document.getElementById('cPayment').textContent = 'Pending';
        timetableContainer.innerHTML = `<p class="ineligible">No schedule generated: Requires university permission (GPA: ${student.GPA}, Semester: ${student.Semester}).</p>`;
      } else if (student.Assigned_Section === 'Not_Assigned') {
        timetableContainer.innerHTML = `<p class="ineligible">No schedule generated: No section assigned.</p>`;
      } else {
        const courseId = courseMap[student.Course];
        const section = courses.find(c => c.course_id === courseId && c.section === student.Assigned_Section);
        if (section) {
          const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
          const timeSlots = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'];
          let tableHTML = `
            <table class="timetable">
              <thead>
                <tr>
                  <th>Time</th>
                  ${days.map(day => `<th>${day}</th>`).join('')}
                </tr>
              </thead>
              <tbody>
          `;
          timeSlots.forEach(time => {
            tableHTML += `<tr><td>${time}</td>`;
            days.forEach(day => {
              if (section.day === day && section.start_time === time) {
                tableHTML += `<td>${section.start_time}-${section.end_time}: ${student.Course}-${section.section} (${section.room})</td>`;
              } else {
                tableHTML += `<td></td>`;
              }
            });
            tableHTML += `</tr>`;
          });
          tableHTML += `</tbody></table>`;
          timetableContainer.innerHTML = tableHTML;
        } else {
          timetableContainer.innerHTML = `<p class="ineligible">No schedule generated: Course data unavailable.</p>`;
        }
      }
    } else {
      timetableContainer.innerHTML = `<p class="ineligible">Student not found.</p>`;
    }
  </script>
</body>
</html>